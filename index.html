<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Game Overview</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
        }
        h1, h2, h3 {
            color: #333;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 4px;
            border-radius: 4px;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>

<h1>Card Game Overview</h1>

<p>This document provides an overview of the card game implemented in <code>main.py</code>. The game allows players to play cards based on specific rules and conditions.</p>

<h2>Key Components</h2>

<h3>Constants</h3>
<p>The game defines several constants to manage card types and ranks:</p>
<pre><code>CARD_TYPE_IN_HAND = "In Hand"
CARD_TYPE_FACE_UP = "Face Up"
CARD_TYPE_FACE_DOWN = "Face Down"
CARD_TYPE_PILE = "Pile"</code></pre>

<h3>Functions</h3>
<ul>
    <li><code>get_playable_cards(player_cards)</code>: Returns the current playable cards based on their type (hand, face up, face down).</li>
    <li><code>is_valid_play(card_rank, pile, seven_rule_active=False)</code>: Validates if a card can be played on the current pile.</li>
    <li><code>handle_special_card(rank, pile)</code>: Handles the effects of special cards (2, 7, 10) and determines if another turn is allowed.</li>
    <li><code>play_card(player, card, distributed_cards, pile)</code>: Plays a card and adds it to the pile, invoking special card effects if applicable.</li>
    <li><code>play_face_down_card(player, distributed_cards, pile)</code>: Manages the playing of face-down cards and checks for game-ending conditions.</li>
    <li><code>handle_human_turn(player, distributed_cards, pile, playable_cards)</code>: Manages the turn of a human player, including card selection and play validation.</li>
    <li><code>play_turn(player, distributed_cards, deck, pile, is_computer=False)</code>: Main function that handles both human and computer turns.</li>
    <li>Utility functions for distributing cards, picking up from the deck, and initializing player cards.</li>
</ul>

<h3>Game Mechanics</h3>
<p>The game is structured around a reinforcement learning environment where the following components are defined:</p>

<h4>States</h4>
<p>The state of the game is represented as a numerical array that includes the ranks of the cards in hand and face-up for both players, as well as the rank of the top card in the pile. This allows the agents to assess the current game situation and make decisions based on the available information.</p>

<h4>Action Space</h4>
<p>The action space consists of the indices of playable cards. Each player can choose to play one of their playable cards or pick up the pile if no valid moves are available. The action space is dynamic and changes based on the cards in hand.</p>

<h4>Transition Function</h4>
<p>The transition function defines how the game state changes in response to an action taken by a player. When a player plays a card, the state is updated to reflect the new configuration of cards in hand, the pile, and the current player's turn. If a player cannot play a card, they pick up the pile, which also alters the state.</p>

<h4>Code Logic</h4>
<p>The code implements the game logic through various functions and classes. The <code>CardGameEnv</code> class encapsulates the game state and provides methods for managing player turns, validating plays, and updating the game state. The <code>DQNAgent</code> class represents the reinforcement learning agent that learns to play the game by interacting with the environment.</p>

<h4>Game Flow</h4>
<p>The game starts by initializing the environment and distributing cards to players. Players take turns playing cards based on the rules defined in the game. The game continues until one player has no cards left or a specific game-ending condition is met.</p>

<h3>Special Features</h3>
<ul>
    <li>Players can play special cards that affect the game state, such as flushing the pile or allowing additional plays.</li>
    <li>After three consecutive plays without cards in hand, players can draw from the deck or convert face-up cards to hand cards.</li>
    <li>The game supports both human vs. human and human vs. computer modes.</li>
</ul>

<h2>Conclusion</h2>
<p>This card game implementation in Python provides a fun and interactive way to play a card game with specific rules and conditions. The code is structured to allow easy modifications and enhancements for future development.</p>

</body>
</html>
